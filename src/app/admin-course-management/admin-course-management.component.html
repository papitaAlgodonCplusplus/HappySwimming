<!-- src/app/admin-course-management/admin-course-management.component.html (Updated) -->
<app-header></app-header>

<div class="course-management-container">
  <div class="page-header">
    <h1 class="page-title">{{ 'adminCourseManagement.title' | translate }}</h1>
    <p class="page-subtitle">{{ 'adminCourseManagement.subtitle' | translate }}</p>
  </div>

  <!-- Error and Success Messages -->
  <div *ngIf="error" class="alert alert-error">
    <span class="alert-icon">⚠️</span>
    <span class="alert-message">{{ error }}</span>
    <button class="alert-close" (click)="clearMessages()">×</button>
  </div>

  <div *ngIf="successMessage" class="alert alert-success">
    <span class="alert-icon">✅</span>
    <span class="alert-message">{{ successMessage }}</span>
    <button class="alert-close" (click)="clearMessages()">×</button>
  </div>

  <!-- Access Denied for Non-Admin Users -->
  <div *ngIf="!isAdmin" class="access-denied">
    <h2>{{ 'adminCourseManagement.accessDenied' | translate }}</h2>
    <p>{{ 'adminCourseManagement.adminRequired' | translate }}</p>
  </div>

  <!-- Admin Course Management Interface -->
  <div *ngIf="isAdmin" class="admin-interface">
    <!-- Action Bar -->
    <div class="action-bar">
      <button class="btn btn-primary" (click)="toggleCreateForm()" [disabled]="isLoading">
        <span class="btn-icon">{{ showCreateForm ? '×' : '+' }}</span>
        {{ showCreateForm ? ('adminCourseManagement.cancelCreate' | translate) : ('adminCourseManagement.createCourse' |
        translate) }}
      </button>

      <div class="action-stats">
        <span class="stat-item">
          {{ 'adminCourseManagement.totalCourses' | translate }}: {{ courses.length }}
        </span>
      </div>
    </div>

    <!-- Create/Edit Course Form -->
    <div *ngIf="showCreateForm" class="course-form-container">
      <div class="form-header">
        <h2>{{ editingCourse ? ('adminCourseManagement.editCourse' | translate) :
          ('adminCourseManagement.createNewCourse' | translate) }}</h2>
        <p class="form-subtitle">{{ 'adminCourseManagement.formSubtitle' | translate }}</p>
      </div>

      <form class="course-form" (ngSubmit)="editingCourse ? updateCourse() : createCourse()">
        <!-- Basic Course Information -->
        <div class="form-section">
          <h3 class="section-title">{{ 'adminCourseManagement.basicInfo' | translate }}</h3>

          <div class="form-grid">
            <div class="form-group">
              <label for="courseName">{{ 'adminCourseManagement.courseName' | translate }} *</label>
              <input type="text" id="courseName" [(ngModel)]="courseForm.name" name="courseName"
                placeholder="e.g., SWIM A STORY" required class="form-control">
            </div>

            <div class="form-group">
              <label for="clientName">{{ 'adminCourseManagement.clientName' | translate }} *</label>
              <input type="text" id="clientName" [(ngModel)]="courseForm.clientName" name="clientName"
                placeholder="e.g., Hotel Riu" required class="form-control">
            </div>
          </div>

          <div class="form-group">
            <label for="description">{{ 'adminCourseManagement.description' | translate }} *</label>
            <textarea id="description" [(ngModel)]="courseForm.description" name="description" rows="4"
              placeholder="For beginners and water-confident kids to build essential safety skills..." required
              class="form-control"></textarea>
          </div>
        </div>

        <!-- Schedule Information -->
        <div class="form-section">
          <h3 class="section-title">{{ 'adminCourseManagement.schedule' | translate }}</h3>
          <p class="section-subtitle">Set the lesson schedule that clients will see (view-only for them)</p>

          <div class="form-grid">
            <div class="form-group">
              <label for="startDate">{{ 'adminCourseManagement.startDate' | translate }} *</label>
              <input type="date" id="startDate" [(ngModel)]="courseForm.startDate" name="startDate" required
                class="form-control">
            </div>

            <div class="form-group">
              <label for="endDate">{{ 'adminCourseManagement.endDate' | translate }} *</label>
              <input type="date" id="endDate" [(ngModel)]="courseForm.endDate" name="endDate" required
                class="form-control">
            </div>
          </div>

          <div class="form-grid">
            <div class="form-group">
              <label for="startTime">{{ 'adminCourseManagement.startTime' | translate }} *</label>
              <select id="startTime" [(ngModel)]="courseForm.startTime" name="startTime" required class="form-control">
                <option value="">{{ 'adminCourseManagement.selectTime' | translate }}</option>
                <option *ngFor="let time of getTimeOptions()" [value]="time.value">{{ time.label }}</option>
              </select>
            </div>

            <div class="form-group">
              <label for="endTime">{{ 'adminCourseManagement.endTime' | translate }} *</label>
              <select id="endTime" [(ngModel)]="courseForm.endTime" name="endTime" required class="form-control">
                <option value="">{{ 'adminCourseManagement.selectTime' | translate }}</option>
                <option *ngFor="let time of getTimeOptions()" [value]="time.value">{{ time.label }}</option>
              </select>
            </div>
          </div>

          <!-- Schedule Preview -->
          <div *ngIf="courseForm.startTime && courseForm.endTime" class="schedule-preview">
            <p class="preview-text">
              {{ 'adminCourseManagement.schedulePreview' | translate }}:
              <strong>{{ formatTimeDisplay(courseForm.startTime) }} - {{ formatTimeDisplay(courseForm.endTime)
                }}</strong>
            </p>
          </div>
        </div>

        <!-- Professional Assignment -->
        <div class="form-section">
          <h3 class="section-title">{{ 'adminCourseManagement.professionalAssignment' | translate }}</h3>

          <div class="form-group">
            <label for="professionalId">{{ 'adminCourseManagement.assignProfessional' | translate }} *</label>
            <select id="professionalId" [(ngModel)]="courseForm.professionalId" name="professionalId" required
              class="form-control">
              <option value="">{{ 'adminCourseManagement.selectProfessional' | translate }}</option>
              <option *ngFor="let professional of professionals" [value]="professional.id">
                {{ professional.name }} - {{ professional.specialties.join(', ') }}
              </option>
            </select>
          </div>
        </div>

        <!-- Flexible Pricing Structure -->
        <div class="form-section">
          <h3 class="section-title">Pricing Structure (Multiple Options)</h3>
          <p class="section-subtitle">Add multiple pricing options based on student count and lesson count. Clients can choose from these options during enrollment.</p>

          <!-- Add New Pricing Line -->
          <div class="pricing-add-section">
            <h4>Add New Pricing Option</h4>
            <div class="pricing-add-grid">
              <div class="form-group">
                <label for="newStudentCount">Students (1-10) *</label>
                <select id="newStudentCount" [(ngModel)]="newPricingLine.studentCount" name="newStudentCount" class="form-control">
                  <option *ngFor="let count of getStudentCountOptions()" [value]="count">{{ count }} {{ count === 1 ? 'student' : 'students' }}</option>
                </select>
              </div>
              
              <div class="form-group">
                <label for="newLessonsCount">Lessons (1-10) *</label>
                <select id="newLessonsCount" [(ngModel)]="newPricingLine.lessonsCount" name="newLessonsCount" class="form-control">
                  <option *ngFor="let count of getLessonsCountOptions()" [value]="count">{{ count }} {{ count === 1 ? 'lesson' : 'lessons' }}</option>
                </select>
              </div>
              
              <div class="form-group">
                <label for="newPrice">Price (€) *</label>
                <input type="number" id="newPrice" [(ngModel)]="newPricingLine.price" name="newPrice" 
                       min="0" step="0.01" class="form-control" placeholder="0.00">
              </div>
              
              <div class="form-group">
                <button type="button" class="btn btn-secondary" (click)="addPricingLine()" [disabled]="isLoading">
                  <span class="btn-icon">+</span>
                  Add Pricing
                </button>
              </div>
            </div>
          </div>

          <!-- Current Pricing Lines -->
          <div *ngIf="courseForm.pricing.length > 0" class="pricing-current-section">
            <h4>Current Pricing Options ({{ courseForm.pricing.length }})</h4>
            <div class="pricing-list">
              <div *ngFor="let pricing of courseForm.pricing; let i = index" class="pricing-line-item">
                <div class="pricing-line-header">
                  <span class="pricing-line-title">
                    {{ pricing.studentCount }} {{ pricing.studentCount === 1 ? 'student' : 'students' }} - 
                    {{ pricing.lessonsCount }} {{ pricing.lessonsCount === 1 ? 'lesson' : 'lessons' }}
                  </span>
                  <button type="button" class="remove-pricing-btn" (click)="removePricingLine(i)" title="Remove pricing line">
                    ×
                  </button>
                </div>
                <div class="pricing-line-controls">
                  <div class="pricing-control-group">
                    <label>Students (1-10)</label>
                    <select [(ngModel)]="pricing.studentCount" 
                            [name]="'studentCount_' + i" 
                            class="form-control pricing-control"
                            (ngModelChange)="updatePricingLine(i, 'studentCount', $event)">
                      <option *ngFor="let count of getStudentCountOptions()" [value]="count">{{ count }}</option>
                    </select>
                  </div>
                  
                  <div class="pricing-control-group">
                    <label>Lessons (1-10)</label>
                    <select [(ngModel)]="pricing.lessonsCount" 
                            [name]="'lessonsCount_' + i" 
                            class="form-control pricing-control"
                            (ngModelChange)="updatePricingLine(i, 'lessonsCount', $event)">
                      <option *ngFor="let count of getLessonsCountOptions()" [value]="count">{{ count }}</option>
                    </select>
                  </div>
                  
                  <div class="pricing-control-group">
                    <label>Price (€)</label>
                    <input type="number" 
                           [(ngModel)]="pricing.price" 
                           [name]="'price_' + i" 
                           min="0" step="0.01" 
                           class="form-control pricing-control"
                           (ngModelChange)="updatePricingLine(i, 'price', $event)">
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Pricing Summary -->
          <div *ngIf="courseForm.pricing.length > 0" class="pricing-summary-preview">
            <h4>Pricing Summary</h4>
            <div class="summary-grid">
              <div *ngFor="let pricing of courseForm.pricing" class="summary-item">
                <span class="summary-label">
                  {{ pricing.studentCount }} {{ pricing.studentCount === 1 ? 'student' : 'students' }}, 
                  {{ pricing.lessonsCount }} {{ pricing.lessonsCount === 1 ? 'lesson' : 'lessons' }}
                </span>
                <span class="summary-price">€{{ pricing.price }}</span>
              </div>
            </div>
          </div>

          <!-- No Pricing Warning -->
          <div *ngIf="courseForm.pricing.length === 0" class="no-pricing-warning">
            <p>⚠️ No pricing options added yet. Please add at least one pricing option.</p>
          </div>
        </div>

        <!-- Form Actions -->
        <div class="form-actions">
          <button type="button" class="btn btn-secondary" (click)="cancelEdit()" [disabled]="isLoading">
            {{ 'adminCourseManagement.cancel' | translate }}
          </button>
          <button type="submit" class="btn btn-primary" [disabled]="isLoading || courseForm.pricing.length === 0">
            <span *ngIf="isLoading" class="loading-spinner"></span>
            {{ editingCourse ? ('adminCourseManagement.updateCourse' | translate) :
            ('adminCourseManagement.createCourse' | translate) }}
          </button>
        </div>
      </form>
    </div>

    <!-- Filters and Search -->
    <div class="filters-container">
      <div class="search-section">
        <div class="search-group">
          <label for="searchTerm">{{ 'adminCourseManagement.search' | translate }}</label>
          <input type="text" id="searchTerm" [(ngModel)]="searchTerm"
            placeholder="{{ 'adminCourseManagement.searchPlaceholder' | translate }}" class="form-control search-input">
        </div>
      </div>

      <div class="filter-section">
        <div class="filter-group">
          <label for="statusFilter">{{ 'adminCourseManagement.filterByStatus' | translate }}</label>
          <select id="statusFilter" [(ngModel)]="statusFilter" class="form-control">
            <option value="all">{{ 'adminCourseManagement.allStatuses' | translate }}</option>
            <option value="active">{{ 'adminCourseManagement.active' | translate }}</option>
            <option value="completed">{{ 'adminCourseManagement.completed' | translate }}</option>
            <option value="cancelled">{{ 'adminCourseManagement.cancelled' | translate }}</option>
          </select>
        </div>

        <div class="filter-group">
          <label for="clientFilter">{{ 'adminCourseManagement.filterByClient' | translate }}</label>
          <select id="clientFilter" [(ngModel)]="clientFilter" class="form-control">
            <option value="all">{{ 'adminCourseManagement.allClients' | translate }}</option>
            <option *ngFor="let client of clientOptions" [value]="client">{{ client }}</option>
          </select>
        </div>
      </div>
    </div>

    <!-- Courses List -->
    <div class="courses-container">
      <div *ngIf="isLoading && courses.length === 0" class="loading-container">
        <div class="loading-spinner-large"></div>
        <p>{{ 'adminCourseManagement.loadingCourses' | translate }}</p>
      </div>

      <div *ngIf="!isLoading && filteredCourses.length === 0" class="empty-state">
        <div class="empty-icon">📚</div>
        <h3>{{ 'adminCourseManagement.noCourses' | translate }}</h3>
        <p>{{ 'adminCourseManagement.noCoursesMessage' | translate }}</p>
      </div>

      <div *ngIf="filteredCourses.length > 0" class="courses-grid">
        <div *ngFor="let course of filteredCourses" class="course-card">
          <!-- Course Header -->
          <div class="course-header">
            <div class="course-title-section">
              <h3 class="course-title">{{ course.name }}</h3>
              <span class="course-code">{{ course.courseCode }}</span>
            </div>
            <div class="course-status">
              <span class="status-badge" [ngClass]="getStatusClass(course.status)">
                {{ ('adminCourseManagement.' + course.status) | translate }}
              </span>
            </div>
          </div>

          <!-- Course Details -->
          <div class="course-details">
            <div class="detail-row">
              <span class="detail-label">{{ 'adminCourseManagement.client' | translate }}:</span>
              <span class="detail-value">{{ course.clientName }}</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">{{ 'adminCourseManagement.professional' | translate }}:</span>
              <span class="detail-value">{{ getProfessionalName(course.professionalId) }}</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">{{ 'adminCourseManagement.duration' | translate }}:</span>
              <span class="detail-value">
                {{ course.startDate | date:'mediumDate' }} - {{ course.endDate | date:'mediumDate' }}
              </span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Schedule:</span>
              <span class="detail-value">
                {{ formatTimeDisplay(course.startTime || '') }} - {{ formatTimeDisplay(course.endTime || '') }}
              </span>
            </div>
            <div class="detail-row">
              <span class="detail-label">{{ 'adminCourseManagement.enrollment' | translate }}:</span>
              <span class="detail-value">{{ course.currentStudents }}/{{ course.maxStudents }} {{
                'adminCourseManagement.students' | translate }}</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Pricing Options:</span>
              <span class="detail-value">{{ course.pricing.length }} options</span>
            </div>
          </div>

          <!-- Course Description -->
          <div class="course-description">
            <p>{{ course.description }}</p>
          </div>

          <!-- Multiple Pricing Preview -->
          <div class="pricing-preview">
            <h4>{{ 'adminCourseManagement.currentPricing' | translate }}</h4>
            <div class="multiple-pricing-display">
              <div *ngFor="let pricing of course.pricing" class="pricing-option-display">
                <span class="pricing-students">{{ pricing.studentCount }}{{ pricing.studentCount === 1 ? ' student' : ' students' }}</span>
                <span class="pricing-lessons">{{ pricing.lessonsCount }} {{ pricing.lessonsCount === 1 ? 'lesson' : 'lessons' }}</span>
                <span class="pricing-amount">€{{ pricing.price }}</span>
              </div>
            </div>
            <div *ngIf="course.pricing.length === 0" class="no-pricing-display">
              <span class="no-pricing-text">No pricing options configured</span>
            </div>
          </div>

          <!-- Course Actions -->
          <div class="course-actions">
            <button class="btn btn-secondary btn-sm" (click)="editCourse(course)" [disabled]="isLoading">
              <span class="btn-icon">✏️</span>
              {{ 'adminCourseManagement.edit' | translate }}
            </button>
            <button class="btn btn-danger btn-sm" (click)="deleteCourse(course)" [disabled]="isLoading">
              <span class="btn-icon">🗑️</span>
              {{ 'adminCourseManagement.delete' | translate }}
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>