<!-- src/app/services-manager/services-manager.component.html (Updated - No Hardcoded Courses) -->
<app-header></app-header>

<div class="services-manager-container">
  <div class="page-header">
    <h1 class="page-title">{{ 'servicesManager.title' | translate }}</h1>
    <p class="page-subtitle">
      {{ userRole === 'client' ? ('servicesManager.clientSubtitle' | translate) : ('servicesManager.professionalSubtitle' | translate) }}
    </p>
    <div *ngIf="userClientName" class="client-info">
      <span class="client-badge">{{ userClientName }}</span>
    </div>
  </div>

  <!-- Error and Success Messages -->
  <div *ngIf="error" class="alert alert-error">
    <span class="alert-icon">⚠️</span>
    <span class="alert-message">{{ error }}</span>
    <button class="alert-close" (click)="clearMessages()">×</button>
  </div>

  <div *ngIf="successMessage" class="alert alert-success">
    <span class="alert-icon">✅</span>
    <span class="alert-message">{{ successMessage }}</span>
    <button class="alert-close" (click)="clearMessages()">×</button>
  </div>

  <!-- Refresh Button -->
  <div class="action-bar">
    <button class="btn btn-secondary" (click)="refreshData()" [disabled]="isLoading">
      <span class="btn-icon">🔄</span>
      {{ 'servicesManager.refresh' | translate }}
    </button>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading && availableCourses.length === 0" class="loading-container">
    <div class="loading-spinner-large"></div>
    <p>{{ 'servicesManager.loadingCourses' | translate }}</p>
  </div>

  <!-- Main Content -->
  <div class="main-content">
    <!-- Available Courses Section -->
    <div class="section">
      <div class="section-header">
        <h2 class="section-title">{{ 'servicesManager.availableCourses' | translate }}</h2>
        <span class="course-count">{{ availableCourses.length }} {{ 'servicesManager.coursesAvailable' | translate }}</span>
      </div>

      <!-- No courses available -->
      <div *ngIf="!isLoading && availableCourses.length === 0" class="empty-state">
        <div class="empty-icon">📚</div>
        <h3>{{ 'servicesManager.noCourses' | translate }}</h3>
        <p *ngIf="userRole === 'client'">{{ 'servicesManager.noCoursesClientMessage' | translate }}</p>
        <p *ngIf="userRole === 'professional'">{{ 'servicesManager.noCoursesProfessionalMessage' | translate }}</p>
        <p *ngIf="userClientName" class="client-note">
          {{ 'servicesManager.coursesForClient' | translate }}: <strong>{{ userClientName }}</strong>
        </p>
      </div>

      <!-- Courses Grid -->
      <div *ngIf="availableCourses.length > 0" class="courses-grid">
        <div *ngFor="let course of availableCourses; trackBy: trackByCourseId" class="course-card">
          <!-- Course Type Badge -->
          <div class="course-badge badge-admin">
            {{ 'servicesManager.adminCourse' | translate }}
          </div>

          <!-- Course Header -->
          <div class="course-header">
            <h3 class="course-title">{{ course.name }}</h3>
            <div *ngIf="course.courseCode" class="course-code">{{ course.courseCode }}</div>
          </div>

          <!-- Course Info -->
          <div class="course-info">
            <!-- Client name -->
            <div class="info-row">
              <span class="info-label">{{ 'servicesManager.client' | translate }}:</span>
              <span class="info-value">{{ course.clientName }}</span>
            </div>

            <!-- Professional assignment -->
            <div class="info-row">
              <span class="info-label">{{ 'servicesManager.professional' | translate }}:</span>
              <span class="info-value">{{ course.professionalName || ('servicesManager.notAssigned' | translate) }}</span>
            </div>

            <!-- Duration -->
            <div class="info-row">
              <span class="info-label">{{ 'servicesManager.duration' | translate }}:</span>
              <span class="info-value">{{ getCourseDuration(course) }}</span>
            </div>

            <!-- Enrollment info -->
            <div class="info-row">
              <span class="info-label">{{ 'servicesManager.enrollment' | translate }}:</span>
              <span class="info-value">{{ course.currentStudents || 0 }}/{{ course.maxStudents || 6 }} {{ 'servicesManager.students' | translate }}</span>
            </div>

            <!-- Availability -->
            <div class="info-row">
              <span class="info-label">{{ 'servicesManager.availability' | translate }}:</span>
              <span class="info-value" [ngClass]="hasAvailableSpots(course) ? 'text-success' : 'text-danger'">
                {{ hasAvailableSpots(course) ? (course.availableSpots + ' ' + ('servicesManager.spotsAvailable' | translate)) : ('servicesManager.courseFull' | translate) }}
              </span>
            </div>
          </div>

          <!-- Course Description -->
          <div class="course-description">
            <p>{{ getCourseDescription(course) }}</p>
          </div>

          <!-- Pricing Information -->
          <div class="course-pricing">
            <div class="price-main">{{ getCoursePrice(course) }}</div>
            <div *ngIf="course.pricing && course.pricing.length > 0" class="pricing-details">
              <div class="pricing-note">{{ getPricingDetails(course) }}</div>
              <div class="pricing-structure">
                <h4>{{ 'servicesManager.pricingStructure' | translate }}</h4>
                <div class="pricing-list">
                  <div *ngFor="let pricing of course.pricing" class="pricing-item">
                    <span class="pricing-students">{{ pricing.studentCount }}{{ pricing.studentCount === 1 ? (' ' + ('servicesManager.student' | translate)) : (' ' + ('servicesManager.students' | translate)) }}</span>
                    <span class="pricing-amount">€{{ pricing.price }} ({{ pricing.lessonsCount }} {{ 'servicesManager.lessons' | translate }})</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Enrollment Status -->
          <div *ngIf="getEnrollmentStatus(course.id)" class="enrollment-status">
            <span class="status-badge" [ngClass]="getStatusClass(getEnrollmentStatus(course.id)!)">
              {{ getLocalizedStatus(getEnrollmentStatus(course.id)!) }}
            </span>
          </div>

          <!-- Course Actions -->
          <div class="course-actions">
            <button 
              *ngIf="!isEnrolledInCourse(course.id) && hasAvailableSpots(course)"
              class="btn btn-primary"
              (click)="selectCourse(course)"
              [disabled]="isLoading">
              <span class="btn-icon">📝</span>
              {{ 'servicesManager.enroll' | translate }}
            </button>
            
            <button 
              *ngIf="!hasAvailableSpots(course)"
              class="btn btn-disabled"
              disabled>
              <span class="btn-icon">🚫</span>
              {{ 'servicesManager.courseFull' | translate }}
            </button>

            <span 
              *ngIf="isEnrolledInCourse(course.id)"
              class="enrolled-label">
              ✅ {{ 'servicesManager.enrolled' | translate }}
            </span>
          </div>
        </div>
      </div>
    </div>

    <!-- Current Enrollments Section -->
    <div class="section" *ngIf="enrollments.length > 0">
      <div class="section-header">
        <h2 class="section-title">{{ 'servicesManager.myEnrollments' | translate }}</h2>
        <span class="course-count">{{ enrollments.length }} {{ 'servicesManager.enrollments' | translate }}</span>
      </div>

      <div class="enrollments-grid">
        <div *ngFor="let enrollment of enrollments; trackBy: trackByEnrollmentId" class="enrollment-card">
          <div class="enrollment-header">
            <h3 class="enrollment-title">{{ enrollment.courseName }}</h3>
            <span class="status-badge" [ngClass]="getStatusClass(enrollment.status)">
              {{ getLocalizedStatus(enrollment.status) }}
            </span>
          </div>

          <div class="enrollment-details">
            <div class="detail-row" *ngIf="enrollment.kidName">
              <span class="detail-label">{{ 'servicesManager.childName' | translate }}:</span>
              <span class="detail-value">{{ enrollment.kidName }}</span>
            </div>
            <div class="detail-row" *ngIf="enrollment.motherContact">
              <span class="detail-label">{{ 'servicesManager.motherContact' | translate }}:</span>
              <span class="detail-value">{{ enrollment.motherContact }}</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">{{ 'servicesManager.enrollmentDate' | translate }}:</span>
              <span class="detail-value">{{ enrollment.enrollmentDate | date:'short' }}</span>
            </div>
            <div *ngIf="enrollment.startDate" class="detail-row">
              <span class="detail-label">{{ 'servicesManager.startDate' | translate }}:</span>
              <span class="detail-value">{{ enrollment.startDate | date:'short' }}</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">{{ 'servicesManager.price' | translate }}:</span>
              <span class="detail-value">€{{ enrollment.price }}</span>
            </div>
            <div *ngIf="enrollment.professionalName" class="detail-row">
              <span class="detail-label">{{ 'servicesManager.professional' | translate }}:</span>
              <span class="detail-value">{{ enrollment.professionalName }}</span>
            </div>
            <div *ngIf="enrollment.notes" class="detail-row">
              <span class="detail-label">{{ 'servicesManager.notes' | translate }}:</span>
              <span class="detail-value">{{ enrollment.notes }}</span>
            </div>
          </div>

          <div *ngIf="enrollment.status === 'pending'" class="enrollment-actions">
            <button 
              class="btn btn-secondary btn-sm"
              (click)="cancelEnrollmentById(enrollment.id)"
              [disabled]="isLoading">
              <span class="btn-icon">❌</span>
              {{ 'servicesManager.cancel' | translate }}
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Enrollment Form Modal -->
  <div *ngIf="showEnrollmentForm" class="modal-overlay" (click)="cancelEnrollment()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>{{ 'servicesManager.enrollInCourse' | translate }}</h2>
        <button class="modal-close" (click)="cancelEnrollment()">×</button>
      </div>

      <div class="modal-body">
        <div *ngIf="selectedCourse" class="selected-course-info">
          <h3>{{ selectedCourse.name }}</h3>
          <p>{{ selectedCourse.description }}</p>
          <div class="course-details-modal">
            <div class="modal-detail">
              <strong>{{ 'servicesManager.client' | translate }}:</strong> {{ selectedCourse.clientName }}
            </div>
            <div class="modal-detail">
              <strong>{{ 'servicesManager.professional' | translate }}:</strong> {{ selectedCourse.professionalName }}
            </div>
            <div class="modal-detail">
              <strong>{{ 'servicesManager.duration' | translate }}:</strong> {{ getCourseDuration(selectedCourse) }}
            </div>
            <div class="modal-detail">
              <strong>{{ 'servicesManager.availability' | translate }}:</strong> {{ selectedCourse.availableSpots }} {{ 'servicesManager.spotsLeft' | translate }}
            </div>
          </div>
          <div class="course-price">{{ getCoursePrice(selectedCourse) }}</div>
          <div *ngIf="getPricingDetails(selectedCourse)" class="pricing-note">{{ getPricingDetails(selectedCourse) }}</div>
        </div>

        <form class="enrollment-form" (ngSubmit)="enrollInCourse()">
          <!-- Child name (required for all courses) -->
          <div class="form-group">
            <label for="kidName">{{ 'servicesManager.childName' | translate }} *</label>
            <input 
              type="text" 
              id="kidName"
              [(ngModel)]="enrollmentForm.kidName"
              name="kidName"
              required
              class="form-control"
              placeholder="{{ 'servicesManager.enterChildName' | translate }}">
          </div>

          <!-- Mother contact (required for all courses) -->
          <div class="form-group">
            <label for="motherContact">{{ 'servicesManager.motherContact' | translate }} *</label>
            <input 
              type="text" 
              id="motherContact"
              [(ngModel)]="enrollmentForm.motherContact"
              name="motherContact"
              required
              class="form-control"
              placeholder="{{ 'servicesManager.enterMotherContact' | translate }}">
          </div>

          <!-- Form Actions -->
          <div class="form-actions">
            <button type="button" class="btn btn-secondary" (click)="cancelEnrollment()" [disabled]="isLoading">
              {{ 'servicesManager.cancel' | translate }}
            </button>
            <button type="submit" class="btn btn-primary" [disabled]="isLoading">
              <span *ngIf="isLoading" class="loading-spinner"></span>
              {{ 'servicesManager.confirmEnrollment' | translate }}
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>