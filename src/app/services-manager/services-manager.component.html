<style>
    @import url('https://fonts.googleapis.com/css2?family=Lexend+Peta:wght@100..900&display=swap');
  </style>
  
  <app-header></app-header>
  <div class="services-manager-container">
    <div class="services-manager-content">
        <h1 class="title">
            {{ (userRole === 'client' ? 'servicesManager.clientTitle' : 'servicesManager.professionalTitle') | translate }}
        </h1>
  
        <div *ngIf="successMessage" class="success-message">
            {{ successMessage }}
        </div>
        
        <div *ngIf="errorMessage" class="error-message">
            {{ errorMessage }}
        </div>
  
        <!-- Professional Verifications Section (only for professionals) -->
        <div *ngIf="userRole === 'professional' && professionalVerifications.length > 0" class="professional-verifications-section">
            <h2 class="section-title">{{ 'servicesManager.myCertifications' | translate }}</h2>
            
            <div class="enrollments-table-container">
                <table class="enrollments-table">
                    <thead>
                        <tr>
                            <th>{{ 'servicesManager.course' | translate }}</th>
                            <th>{{ 'servicesManager.certification' | translate }}</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let course of professionalCourses">
                            <td>{{ course.name }}</td>
                            <td>
                                <span class="status-badge" [ngClass]="isCourseCertified(course.id) ? 'status-approved' : 'status-pending'">
                                    {{ isCourseCertified(course.id) ? ('servicesManager.certified' | translate) : ('servicesManager.notCertified' | translate) }}
                                </span>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
  
        <!-- Enrollment Form Section -->
        <div class="enrollment-form-section">
            <h2 class="section-title">{{ 'servicesManager.newEnrollment' | translate }}</h2>
        
            <div class="form-container">
                <!-- Course Selection -->
                <div class="form-group">
                    <label for="courseSelect">{{ 'servicesManager.selectCourse' | translate }}<span class="required">*</span></label>
                    <select id="courseSelect" [(ngModel)]="selectedCourse" (change)="onCourseSelect()" class="form-control" [disabled]="isLoading">
                        <option value="" disabled selected>-- {{ 'servicesManager.selectCourse' | translate }} --</option>
                        <ng-container *ngIf="userRole === 'client'">
                            <option *ngFor="let course of clientCourses" [value]="course.id">
                                {{ course.name }} - {{ course.duration }} {{ 'clientServices.children36.hours' | translate }} (€{{ course.price }})
                            </option>
                        </ng-container>
                        <ng-container *ngIf="userRole === 'professional'">
                            <option *ngFor="let course of professionalCourses" [value]="course.id">
                                {{ course.name }} - {{ course.duration }} {{ 'clientServices.children36.hours' | translate }} (€{{ course.price }})
                            </option>
                        </ng-container>
                    </select>
                </div>
              
                <!-- Course Description (if selected) -->
                <div *ngIf="getSelectedCourseDetails()?.description" class="course-description">
                    {{ getSelectedCourseDetails()?.description }}
                </div>
              
                <!-- Professional Selection (Client only) -->
                <div *ngIf="userRole === 'client'" class="form-group">
                    <label for="professionalSelect">{{ 'servicesManager.selectProfessional' | translate }}<span class="required">*</span></label>
                    <select id="professionalSelect" [(ngModel)]="selectedProfessional" class="form-control" [disabled]="!selectedCourse || isLoading">
                        <option value="" disabled selected>-- {{ 'servicesManager.selectProfessional' | translate }} --</option>
                        <option *ngFor="let prof of availableProfessionals" [value]="prof.id" [disabled]="!prof.available">
                            {{ prof.name }} {{ !prof.available ? '(' + ('servicesManager.notAvailable' | translate) + ')' : '' }}
                        </option>
                    </select>
                </div>
              
                <!-- Start Date -->
                <div class="form-group">
                    <label for="startDate">{{ 'servicesManager.startDate' | translate }}<span class="required">*</span></label>
                    <input type="date" id="startDate" [(ngModel)]="startDate" class="form-control" [disabled]="isLoading">
                </div>
              
                <!-- Preferred Time -->
                <div class="form-group">
                    <label for="preferredTime">{{ 'servicesManager.preferredTime' | translate }}</label>
                    <select id="preferredTime" [(ngModel)]="preferredTime" class="form-control" [disabled]="isLoading">
                        <option value="" selected>{{ 'servicesManager.noPreference' | translate }}</option>
                        <option value="morning">{{ 'servicesManager.morning' | translate }}</option>
                        <option value="afternoon">{{ 'servicesManager.afternoon' | translate }}</option>
                        <option value="evening">{{ 'servicesManager.evening' | translate }}</option>
                    </select>
                </div>
              
                <!-- Submit Button -->
                <div class="button-container">
                    <button class="btn btn-submit" (click)="onSubmit()" [disabled]="isLoading">
                        <span *ngIf="!isLoading">{{ 'servicesManager.submit' | translate }}</span>
                        <span *ngIf="isLoading">{{ 'servicesManager.processing' | translate }}</span>
                    </button>
                </div>
            </div>
        </div>
      
        <!-- My Enrollments Section -->
        <div class="my-enrollments-section">
            <h2 class="section-title">{{ 'servicesManager.myEnrollments' | translate }}</h2>
        
            <div *ngIf="myEnrollments.length === 0" class="no-enrollments-message">
                {{ 'servicesManager.noEnrollments' | translate }}
            </div>
        
            <div *ngIf="myEnrollments.length > 0" class="enrollments-table-container">
                <table class="enrollments-table">
                    <thead>
                        <tr>
                            <th>{{ 'servicesManager.course' | translate }}</th>
                            <th>{{ 'servicesManager.status' | translate }}</th>
                            <th>{{ 'servicesManager.enrollmentDate' | translate }}</th>
                            <th>{{ 'servicesManager.startDate' | translate }}</th>
                            <th *ngIf="userRole === 'client'">{{ 'servicesManager.professional' | translate }}</th>
                            <th>{{ 'servicesManager.price' | translate }}</th>
                            <th>{{ 'servicesManager.actions' | translate }}</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let enrollment of myEnrollments">
                            <td>{{ enrollment.courseName }}</td>
                            <td>
                                <span class="status-badge" [ngClass]="getStatusClass(enrollment.status)">
                                    {{ getLocalizedStatus(enrollment.status) }}
                                </span>
                            </td>
                            <td>{{ enrollment.enrollmentDate | date:'shortDate' }}</td>
                            <td>{{ enrollment.startDate ? (enrollment.startDate | date:'shortDate') : ('servicesManager.pending' | translate) }}</td>
                            <td *ngIf="userRole === 'client'">{{ enrollment.professionalName || ('servicesManager.notAssigned' | translate) }}</td>
                            <td>€{{ enrollment.price }}</td>
                            <td>
                                <button *ngIf="enrollment.status === 'pending'" class="btn btn-cancel" (click)="cancelEnrollment(enrollment.id)">
                                    {{ 'servicesManager.cancel' | translate }}
                                </button>
                                <span *ngIf="enrollment.status !== 'pending'">-</span>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Combined View (for professionals) - Shows both enrollments and certifications in a combined table -->
        <div *ngIf="userRole === 'professional' && (myEnrollments.length > 0 || professionalVerifications.length > 0)" class="combined-view-section">
            <h2 class="section-title">{{ 'servicesManager.combinedView' | translate }}</h2>
            
            <div class="enrollments-table-container">
                <table class="enrollments-table">
                    <thead>
                        <tr>
                            <th>{{ 'servicesManager.course' | translate }}</th>
                            <th>{{ 'servicesManager.type' | translate }}</th>
                            <th>{{ 'servicesManager.status' | translate }}</th>
                            <th>{{ 'servicesManager.details' | translate }}</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Show certified courses -->
                        <ng-container *ngFor="let courseId of professionalVerifications">
                            <tr *ngIf="getProfessionalCourseById(courseId) as course">
                                <td>{{ course.name }}</td>
                                <td>{{ 'servicesManager.certification' | translate }}</td>
                                <td>
                                    <span class="status-badge status-approved">
                                        {{ 'servicesManager.active' | translate }}
                                    </span>
                                </td>
                                <td>{{ 'servicesManager.canTeach' | translate }}</td>
                            </tr>
                        </ng-container>
                        
                        <!-- Show enrollments -->
                        <ng-container *ngFor="let enrollment of myEnrollments">
                            <tr>
                                <td>{{ enrollment.courseName }}</td>
                                <td>{{ 'servicesManager.enrollment' | translate }}</td>
                                <td>
                                    <span class="status-badge" [ngClass]="getStatusClass(enrollment.status)">
                                        {{ getLocalizedStatus(enrollment.status) }}
                                    </span>
                                </td>
                                <td>
                                    <span *ngIf="enrollment.startDate">
                                        {{ 'servicesManager.startingOn' | translate }}: {{ enrollment.startDate | date:'shortDate' }}
                                    </span>
                                    <span *ngIf="!enrollment.startDate">
                                        {{ 'servicesManager.pending' | translate }}
                                    </span>
                                </td>
                            </tr>
                        </ng-container>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
  </div>